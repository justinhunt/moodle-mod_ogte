<div class="container">
    <h3 class="ogte-section-title">{{#str}}articlerewriter, mod_ogte{{/str}}</h3>
    <span class="ogte-panel-instructions">{{#str}}articlerewrite_instructions, mod_ogte{{/str}}</span><br/>
    <div class="container">
        <div class="row article-rewriter-row">
            <div class="column-always-visible">
                <h4>{{#str}}original-article, mod_ogte{{/str}}</h4>
                <textarea id="{{uniqid}}_ar_originaltext" class="mod-ogte-textarea ogte-wide" placeholder="{{#str}}paste-text-here, mod_ogte{{/str}}">{{passage}}</textarea><br/>
                <div id="{{uniqid}}_ar_originalstats" class="mod-ogte-stats ogte_rewriter_stats"></div>

                <fieldset id="difficulty-choice">
                    <legend>{{#str}}rewritten-article-difficulty, mod_ogte{{/str}}</legend>
                    <div class="btn-group btn-group-toggle" data-toggle="buttons">
                    <label class="btn btn-secondary active">
                        <input type="radio" name="difficulty" value="1" checked> One (simplest)
                    </label>
                    <label class="btn btn-secondary">
                        <input type="radio" name="difficulty" value="2"> Two
                    </label>
                    <label class="btn btn-secondary">
                        <input type="radio" name="difficulty" value="3"> Three
                    </label>
                    <label class="btn btn-secondary">
                        <input type="radio" name="difficulty" value="4"> Four
                    </label>
                    <label class="btn btn-secondary">
                        <input type="radio" name="difficulty" value="5"> Five
                    </label>
                    </div>
                </fieldset>

                <button class="btn btn-primary" id="{{uniqid}}_ar_button" type="button" style="width: 100%; max-width: 800px">{{#str}}rewrite-article, mod_ogte{{/str}}</button>

            </div>
            <div class="column-initially-hidden">

                <div id="{{uniqid}}_ar_rewritten"  style="display: none">
                    <h4>{{#str}}rewritten-article, mod_ogte{{/str}}</h4>
                    <div id="{{uniqid}}_ar_spinner" style="text-align: center; width: 100%; display: none;"><i class="fa fa-spinner fa-spin fa-lg"></i></div>
                    <textarea id="the_ar_result" class="mod-ogte-textarea ogte-wide" style="display: none;"></textarea>
                    <div id="{{uniqid}}_ar_resultstats" class="mod-ogte-stats ogte_rewriter_stats" style="display: none;"></div>
                    <!-- actions -->
                    <div id="ogte_rewriter_actions" class="mod-ogte-passage-opts" style="display: none">
                        <div class="ogte-spacer"></div>
                        <div class="ogte_article_action_button ogte_article_download_button">
                            <a class="btn btn-secondary ogte_downloadbutton" data-download-target="#the_ar_result"></a>
                        </div>
                        <div class="ogte_article_action_button ogte_article_copy_button">
                            <a class="btn btn-secondary ogte_clipboardbutton" data-clipboard-action="copy" data-clipboard-target="#the_ar_result"></a>
                            <span class="ogte_copied" style="display: none">{{#str}}copied, mod_ogte{{/str}}</span>
                        </div>
                    </div>
                    <div class=" ogte_sendtoeditor_button text-center" id="ogte_ar_sendtoeditor_button" >
                        <a class="btn btn-secondary ogte_ar_sendtoeditor_button" data-send-target="#the_ar_result">{{#str}}send-to-editor, mod_ogte{{/str}}</a>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>
{{^element.frozen}}
    {{#js}}
        // <script>
            require(['jquery', 'core/templates','core/notification','mod_ogte/utils'], function($,templates,notification, utils) {

                var theresult= $('#the_ar_result');
                var originalstats= $('#{{uniqid}}_ar_originalstats');
                var resultstats= $('#{{uniqid}}_ar_resultstats');
                var rewritten= $('#{{uniqid}}_ar_rewritten');
                var actions= $('#ogte_rewriter_actions');
                var spinner= $('#{{uniqid}}_ar_spinner');
                var sendtoeditor= $('#ogte_ar_sendtoeditor_button');

                //labels
                var label_rewrite = '{{#str}}rewrite-article, mod_ogte{{/str}}';
                var label_rewriting = '<i class="fa fa-spinner fa-spin fa-lg"></i><br />';


                utils.setCloudPoodllToken('{{cloudpoodlltoken}}');

                $('#{{uniqid}}_ar_button').on('click',function(){

                    var thebutton = $(this);
                    var usetext = $('#{{uniqid}}_ar_originaltext').val();
                    var difficulty = $('input[name="difficulty"]:checked').val();

                    //no super long readings or empty ones
                    if(!usetext || usetext.trim()==='') {
                        notification.alert('{{#str}}entersomething, mod_ogte{{/str}}');
                        return;
                    }
                    if(usetext.length > 5000){
                        notification.alert('{{#str}}texttoolong5000, mod_ogte{{/str}}');
                        return;
                    }

                    //change button caption to a spinner
                    thebutton.html(label_rewriting);

                    //add stats to original
                    var textStatsData = utils.analyzeText(usetext);
                    templates.render('mod_ogte/textstatstable', textStatsData).done(function(html, js) {
                        originalstats.fadeOut("fast", function() {
                            templates.replaceNodeContents(originalstats, html, js);
                            originalstats.fadeIn("fast");
                        }.bind(this));

                    }.bind(this)).fail(notification.exception);


                    utils.call_ai(usetext,'en-US',difficulty,'rewrite_article',function(newarticle){
                        //restore button caption
                        thebutton.text(label_rewrite);

                        //show results panel
                        rewritten.show();
                        theresult.val(newarticle);
                        theresult.show();

                        //add stats to result
                        var textStatsData = utils.analyzeText(newarticle);
                        templates.render('mod_ogte/textstatstable', textStatsData).done(function(html, js) {
                            resultstats.fadeOut("fast", function() {
                                templates.replaceNodeContents(resultstats, html, js);
                                resultstats.fadeIn("fast");
                            }.bind(this));

                        }.bind(this)).fail(notification.exception);

                        //show actions and send to editor button
                        actions.show();
                        sendtoeditor.show();

                    });

                });

            });
    {{/js}}
{{/element.frozen}}