{"version":3,"file":"popoverhelper.min.js","sources":["../src/popoverhelper.js"],"sourcesContent":["define(['jquery', 'core/log','core/templates', 'mod_ogte/dependencyloader', 'theme_boost/popover'], function ($, log,templates,dloader,popover,) {\n    \"use strict\"; // jshint ;_;\n\n    /*\n    This file is to manage the transcript popover\n     */\n\n    log.debug('OGTE Popover helper: initialising');\n\n    return {\n\n        lastitem: false,\n        dispose: false, //Bv4 = dispose  Bv3 = destroy\n        popuptitle: 'Actions: Ignore',//M.util.get_string('popoveractions','mod_ogte','Ignore'), //need to set this up to work in renderer\n        currentword: '',\n        showing: false,\n\n        init: function () {\n            this.register_events();\n\n        },\n\n        register_events: function () {\n\n            var that = this;\n            //when the ignore switch is toggled, call doIgnore\n            $(document).on('change','#mod_ogte_actionignoreswitch',function(e) {\n                var word = $(this).attr('data-theword');\n                var ignore = $(this).is(':checked');\n                that.onIgnore(word, ignore);\n            });\n            $(document).on('click', function(e) {\n                    if (that.lastitem && !$(e.target).closest('.popover').length && !$(e.target).closest(that.lastitem).length && that.showing) {\n                        $(that.lastitem).popover(that.disposeWord());\n                        that.showing = false;\n                    }\n            });\n        },\n\n        //different bootstrap/popover versions have a different word for \"dispose\" so this method bridges that.\n        //we can not be sure what version is installed\n        disposeWord: function () {\n            if (this.dispose) {\n                return this.dispose;\n            }\n            var version = '3';\n            if ($.fn.popover.Constructor.hasOwnProperty('VERSION')) {\n                version = $.fn.popover.Constructor.VERSION.charAt(0);\n            }\n            switch (version) {\n                case '4':\n                    this.dispose = 'dispose';\n                    break;\n                case '3':\n                default:\n                    this.dispose = 'destroy';\n                    break;\n            }\n            return this.dispose;\n        },\n\n        remove: function (item) {\n            if (item) {\n                $(item).popover(this.disposeWord());\n            } else if (this.lastitem) {\n                $(this.lastitem).popover(this.disposeWord());\n                this.lastitem = false;\n            }\n        },\n\n        isShowing: function(item){\n            if(this.lastitem === item) {\n                return true;\n            }else{\n                return false;\n            }\n        },\n\n        doPopup: function (item,itemword, ignoring) {\n            var that = this;\n            //if we are already showing this item then dispose of it, set last item to null and go home\n            if (this.lastitem === item) {\n                $(this.lastitem).popover(this.disposeWord());\n                that.showing = false;\n                this.lastitem = false;\n                return;\n            }\n\n            //dispose of previous popover, and remember this one\n            if (this.lastitem) {\n                $(this.lastitem).popover(this.disposeWord());\n                that.showing = false;\n                this.lastitem = false;\n            }\n            this.lastitem = item;\n\n            //let's add the popover\n            var tdata={};\n            tdata.theword=itemword;\n            tdata.ignoring=false;\n            tdata.ignoring=ignoring;\n            log.debug('OGTE Popover helper: doPopup' + itemword + ' ignoring=' + ignoring);\n            templates.render('mod_ogte/popoveractionform', tdata).done(function(html, js) {\n                $(item).popover({\n                    title: that.popuptitle,\n                    content: function(){return html;},\n                    trigger: 'manual',\n                    placement: 'top',\n                    html: true,\n                    sanitize: false\n                });\n                $(item).popover('show');\n                that.showing = true;\n            });\n\n        },\n\n        //this function is overridden by the calling class\n        //word = word, ignore = true/false\n        onIgnore: function(word,ignore){console.log('onIgnore');},\n\n    };//end of return value\n});"],"names":["define","$","log","templates","dloader","popover","debug","lastitem","dispose","popuptitle","currentword","showing","init","register_events","that","this","document","on","e","word","attr","ignore","is","onIgnore","target","closest","length","disposeWord","version","fn","Constructor","hasOwnProperty","VERSION","charAt","remove","item","isShowing","doPopup","itemword","ignoring","tdata","theword","render","done","html","js","title","content","trigger","placement","sanitize","console"],"mappings":"AAAAA,gCAAO,CAAC,SAAU,WAAW,iBAAkB,4BAA6B,wBAAwB,SAAUC,EAAGC,IAAIC,UAAUC,QAAQC,gBAOnIH,IAAII,MAAM,qCAEH,CAEHC,UAAU,EACVC,SAAS,EACTC,WAAY,kBACZC,YAAa,GACbC,SAAS,EAETC,KAAM,gBACGC,mBAITA,gBAAiB,eAETC,KAAOC,KAEXd,EAAEe,UAAUC,GAAG,SAAS,gCAA+B,SAASC,OACxDC,KAAOlB,EAAEc,MAAMK,KAAK,gBACpBC,OAASpB,EAAEc,MAAMO,GAAG,YACxBR,KAAKS,SAASJ,KAAME,WAExBpB,EAAEe,UAAUC,GAAG,SAAS,SAASC,GACrBJ,KAAKP,WAAaN,EAAEiB,EAAEM,QAAQC,QAAQ,YAAYC,SAAWzB,EAAEiB,EAAEM,QAAQC,QAAQX,KAAKP,UAAUmB,QAAUZ,KAAKH,UAC/GV,EAAEa,KAAKP,UAAUF,QAAQS,KAAKa,eAC9Bb,KAAKH,SAAU,OAO/BgB,YAAa,cACLZ,KAAKP,eACEO,KAAKP,YAEZoB,QAAU,OACV3B,EAAE4B,GAAGxB,QAAQyB,YAAYC,eAAe,aACxCH,QAAU3B,EAAE4B,GAAGxB,QAAQyB,YAAYE,QAAQC,OAAO,IAG7C,MADDL,aAEKpB,QAAU,oBAIVA,QAAU,iBAGhBO,KAAKP,SAGhB0B,OAAQ,SAAUC,MACVA,KACAlC,EAAEkC,MAAM9B,QAAQU,KAAKY,eACdZ,KAAKR,WACZN,EAAEc,KAAKR,UAAUF,QAAQU,KAAKY,oBACzBpB,UAAW,IAIxB6B,UAAW,SAASD,aACbpB,KAAKR,WAAa4B,MAOzBE,QAAS,SAAUF,KAAKG,SAAUC,cAC1BzB,KAAOC,QAEPA,KAAKR,WAAa4B,YAClBlC,EAAEc,KAAKR,UAAUF,QAAQU,KAAKY,eAC9Bb,KAAKH,SAAU,YACVJ,UAAW,GAKhBQ,KAAKR,WACLN,EAAEc,KAAKR,UAAUF,QAAQU,KAAKY,eAC9Bb,KAAKH,SAAU,OACVJ,UAAW,QAEfA,SAAW4B,SAGZK,MAAM,GACVA,MAAMC,QAAQH,SACdE,MAAMD,UAAS,EACfC,MAAMD,SAASA,SACfrC,IAAII,MAAM,+BAAiCgC,SAAW,aAAeC,UACrEpC,UAAUuC,OAAO,6BAA8BF,OAAOG,MAAK,SAASC,KAAMC,IACtE5C,EAAEkC,MAAM9B,QAAQ,CACZyC,MAAOhC,KAAKL,WACZsC,QAAS,kBAAkBH,MAC3BI,QAAS,SACTC,UAAW,MACXL,MAAM,EACNM,UAAU,IAEdjD,EAAEkC,MAAM9B,QAAQ,QAChBS,KAAKH,SAAU,MAOvBY,SAAU,SAASJ,KAAKE,QAAQ8B,QAAQjD,IAAI"}